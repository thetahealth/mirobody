System.register(["./index-legacy-BCYsgP_m.js","./vendor-antd-legacy-B_nlExEM.js","./index-legacy-xiHj4BPv.js","./index-legacy-COjwk9rd.js","./index-legacy-CtjrcoBn.js","./account-legacy-4gI0f2zM.js","./vendor-firebase-legacy-SmJg7pDS.js","./logo-legacy-Dj_BY5C3.js","./index-legacy-BGOD2yAB.js","./vendor-monaco-legacy-DGc0n2EJ.js"],function(e,t){"use strict";var a,r,s,i,l,n,d,o,c,x,p,f,u,m,h,y,g,_,j,b,w,v,S,N;return{setters:[e=>{a=e.u,r=e.k,s=e.T,i=e.U,l=e.V,n=e.b,d=e.a,o=e.j,c=e.M},e=>{x=e.r,p=e.e,f=e.B,u=e.t,m=e.u,h=e.v,y=e.w,g=e.x,_=e.I,j=e.f},e=>{b=e.H},e=>{w=e.M},e=>{v=e.s,S=e.T},e=>{N=e.a},null,null,null,null],execute:function(){const{RangePicker:t}=m,C=[{label:"Last 7 Days",value:[p().add(-7,"d").startOf("day"),p().endOf("day")]},{label:"Last 14 Days",value:[p().add(-14,"d").startOf("day"),p().endOf("day")]},{label:"Last 30 Days",value:[p().add(-30,"d").startOf("day"),p().endOf("day")]},{label:"Last 90 Days",value:[p().add(-90,"d").startOf("day"),p().endOf("day")]}],T="HH:mm:ss",k="YYYY-MM-DD",E=(e,t=20)=>e?e.length<=t?e:`${e.substring(0,t)}...`:"";e("default",()=>{const{t:e}=a(),m=r(),[O,R]=x.useState([]),[K,z]=x.useState(!1),[I,$]=x.useState([p().startOf("day"),p().endOf("day")]),[A,D]=x.useState([]),[M,H]=x.useState([]),[B,L]=x.useState(""),[Y,F]=x.useState(""),[q,P]=x.useState(1),[U,V]=x.useState(20),[W,G]=x.useState(0),[J,Q]=x.useState(new Set),X=x.useRef(null),Z=N(e=>e.current_drive_user_id),[ee,te]=x.useState([]),[ae,re]=x.useState([]),[se,ie]=x.useState(!1),[le,ne]=x.useState([]),[de,oe]=x.useState(new Map),ce=x.useRef(null),[xe,pe]=x.useState(!0),[fe,ue]=x.useState([]),me=x.useCallback(async()=>{X.current&&X.current.abort(),X.current=new AbortController;const e=X.current.signal;try{z(!0);const[t,a]=I,r=`${k} ${T}`,d=s(i({page:q,page_size:U,filters:{category:A,source:M},filterKeys:["category","source"],query:Y,start_time:t?.format(r),end_time:a?.format(r),order:fe}),l("target_user_id",Z)),o=await n.getHealthIndicator(d,e);if(e.aborted)return;R(o.data||[]),G(o.total||0),z(!1),oe(e=>{const t=new Map(e),a=new Map;return(o.data||[]).forEach(e=>{a.set(String(e.id),e)}),t.forEach((e,r)=>{const s=a.get(String(r));s&&t.set(String(r),s)}),t})}catch(t){if("CanceledError"===t.name||"AbortError"===t.name)return;d.error("ERROR: fetchIndicatorData",t)}finally{z(!1)}},[I,A,M,Y,q,U,Z,fe]);x.useEffect(()=>{(async()=>{if(!se)try{const e=await n.getHealthIndicatorCategories(),t=Array.isArray(e?.category)?e.category:[],a=Array.isArray(e?.source)?e.source:[];te(t),re(a),ie(!0)}catch(e){d.error("ERROR: fetchHealthIndicatorCategories",e),te([]),re([]),ie(!0)}})()},[se]),x.useEffect(()=>()=>{X.current&&X.current.abort(),ce.current&&clearTimeout(ce.current)},[]),x.useEffect(()=>{se&&me()},[I,A,M,Y,q,U,Z,se,me]),x.useEffect(()=>{P(1)},[Z]);const he=[{id:"indicator",accessorKey:"indicator",header:e("indicator_name"),size:260,meta:{fixed:"start",editable:!0,sortable:!0,ellipsis:{showTooltip:!0}}},{id:"full_name",accessorKey:"full_name",header:e("indicator_full_name"),size:200,meta:{editable:!0,ellipsis:{showTooltip:!0}}},{id:"value",accessorKey:"value",header:e("value"),size:300,meta:{editable:!0,ellipsis:{showTooltip:!0}}},{id:"start_time",accessorKey:"start_time",header:e("indicator_start_time"),meta:{editable:!0,sortable:!0}},{id:"end_time",accessorKey:"end_time",header:e("indicator_end_time"),meta:{editable:!0}},{id:"indicator_standard",accessorKey:"indicator_standard",header:e("indicator_standard"),meta:{editable:!0}},{id:"comment",accessorKey:"comment",header:e("indicator_comment"),size:300,meta:{editable:!0,ellipsis:{showTooltip:!0}}},{id:"llm_description",accessorKey:"llm_description",header:e("indicator_llm_description"),size:300,meta:{editable:!0,ellipsis:{showTooltip:!0}}},{id:"search_type",accessorKey:"search_type",header:e("search_type"),size:100,meta:{ellipsis:{showTooltip:!0}}},{id:"indicator_sim",accessorKey:"indicator_sim",header:e("indicator_sim"),size:150,meta:{ellipsis:{showTooltip:!0}}},{id:"source",accessorKey:"source",header:"source",size:150,meta:{ellipsis:{showTooltip:!0}}},{id:"file_name",accessorKey:"file_name",header:"file_name",size:300,meta:{sortable:!0,ellipsis:{showTooltip:!0}}},{id:"original_data",accessorKey:"original_data",header:"original_data",size:300,meta:{editor:{type:"json"}}}],ye=x.useCallback(e=>{ne(e),oe(t=>{const a=new Map(t),r=new Set(e.map(e=>String(e)));t.forEach((e,t)=>{r.has(String(t))||a.delete(String(t))});const s=new Map;return O.forEach(e=>{s.set(String(e.id),e)}),e.forEach(e=>{if(!a.has(String(e))){const t=s.get(String(e));t&&a.set(String(e),t)}}),a})},[O]),ge=x.useMemo(()=>({selectedRowKeys:le,onChange:ye}),[le,ye]),_e=async()=>{try{await n.deleteHealthIndicator(le),await me(),ne([]),oe(new Map),j.success(e("delete_success"))}catch(t){d.error("ERROR: onDeleteSelected",t),j.error(e("delete_failed"))}},je=le.length>0;return o.jsxs("div",{className:"w-full h-dvh overflow-hidden flex flex-col",children:[o.jsx(b,{}),o.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[o.jsx(w,{}),o.jsxs("div",{className:"flex flex-col flex-1 overflow-x-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mt-[12px] pl-[24px] pr-[24px]",children:[o.jsx("div",{className:"text-[24px] font-[500] text-[#111827] select-none",children:e("data_property")}),o.jsx(f,{type:"default",icon:o.jsx(u,{}),onClick:()=>m("/indicator/new"),children:e("switch_to_new_mode")})]}),o.jsxs("div",{className:`pl-[24px] ${v.filterContainer}`,children:[o.jsxs("div",{className:v.filterHeader,children:[o.jsxs("div",{className:"flex items-center gap-[16px] flex-1",children:[o.jsxs("div",{children:[e("date_range"),":"]}),o.jsx(t,{presets:[{label:o.jsx("span",{"aria-label":"Current Time to End of Day",children:"Now ~ EOD"}),value:()=>[p(),p().endOf("day")]},...C],format:`${k} ${T}`,onChange:e=>{e&&($(e),P(1))},value:I,showTime:!0})]}),o.jsxs("div",{className:"flex items-center gap-[16px]",children:[o.jsx(f,{onClick:()=>{D([]),H([]),L(""),F(""),P(1),ue([]),ce.current&&clearTimeout(ce.current)},children:e("reset")}),o.jsxs("span",{className:"text-[14px] text-[#666]",children:[e("selected"),": ",le.length]}),o.jsx(f,{type:"primary",onClick:async()=>{const t=le.map(e=>{const t=de.get(String(e));return t?{name:t.indicator||t.full_name||"",id:t.id,startTime:t.start_time||"",endTime:t.end_time||""}:{name:"",id:e,startTime:"",endTime:""}}).filter(Boolean);c.confirm({title:e("delete_selected_indicators"),content:o.jsxs(o.Fragment,{children:[o.jsx("div",{children:e("delete_selected_indicators_content")}),o.jsxs("div",{style:{marginTop:12},children:[o.jsxs("div",{style:{fontWeight:500,marginBottom:8},children:[e("selected_indicators"),":"]}),o.jsx("div",{className:"max-h-[200px] overflow-y-auto overflow-x-auto border border-[#d9d9d9] rounded-[4px] w-full",children:o.jsxs("table",{className:"w-full border-collapse",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"bg-[#fafafa] border-b border-[#f0f0f0]",children:[o.jsx("th",{className:"text-left text-[14px] font-[500] text-[rgba(0,0,0,0.85)] px-[12px] py-[4px] border-r border-[#f0f0f0]",children:e("indicator_name")}),o.jsx("th",{className:"text-left text-[14px] font-[500] text-[rgba(0,0,0,0.85)] px-[12px] py-[4px] border-r border-[#f0f0f0]",children:"ID"}),o.jsx("th",{className:"text-left text-[14px] font-[500] text-[rgba(0,0,0,0.85)] px-[12px] py-[4px] border-r border-[#f0f0f0]",children:e("indicator_start_time")}),o.jsx("th",{className:"text-left text-[14px] font-[500] text-[rgba(0,0,0,0.85)] px-[12px] py-[4px]",children:e("indicator_end_time")})]})}),o.jsx("tbody",{children:t.map((e,t)=>o.jsxs("tr",{className:"border-b border-[#f0f0f0] last:border-b-0",children:[o.jsx("td",{className:"text-[14px] text-[#666] px-[12px] py-[4px] border-r border-[#f0f0f0] whitespace-nowrap",children:e.name||"-"}),o.jsx("td",{className:"text-[14px] text-[#666] px-[12px] py-[4px] border-r border-[#f0f0f0] whitespace-nowrap",children:e.id}),o.jsx("td",{className:"text-[14px] text-[#666] px-[12px] py-[4px] border-r border-[#f0f0f0] whitespace-nowrap",children:e.startTime||"-"}),o.jsx("td",{className:"text-[14px] text-[#666] px-[12px] py-[4px] whitespace-nowrap",children:e.endTime||"-"})]},t))})]})})]})]}),onOk:_e,OkButton:({loading:t,onClick:a})=>o.jsx(f,{size:"large",onClick:a,loading:t,style:{height:"36px",backgroundColor:"#EC221F",color:"#fff",border:"none"},children:e("delete")})})},disabled:!je,children:e("delete")}),o.jsx(f,{type:"link",onClick:()=>pe(!xe),className:v.expandButton,icon:xe?o.jsx(h,{}):o.jsx(y,{}),children:e(xe?"collapse":"expand")})]})]}),xe&&o.jsxs("div",{className:`${v.filterContent} flex flex-col gap-[16px]`,children:[o.jsxs("div",{className:"flex items-center gap-[16px]",children:[o.jsxs("div",{children:[e("category"),":"]}),o.jsx(g,{mode:"multiple",className:v.multipleSelect,style:{width:500},placeholder:e("please_select"),options:Array.isArray(ee)?ee.map(e=>({label:e,value:e})):[],onChange:e=>{D(e),P(1)},value:A,maxTagCount:"responsive"})]}),o.jsxs("div",{className:"flex items-center gap-[16px]",children:[o.jsxs("div",{children:[e("source"),":"]}),o.jsx(g,{mode:"multiple",className:v.multipleSelect,style:{width:500},placeholder:e("please_select"),options:Array.isArray(ae)?ae.map(e=>({label:e,value:e})):[],onChange:e=>{H(e),P(1)},value:M,maxTagCount:"responsive"})]}),o.jsxs("div",{className:"flex items-center gap-[16px]",children:[o.jsxs("div",{children:[e("search"),":"]}),o.jsx(_.TextArea,{style:{width:500},placeholder:e("search_placeholder"),value:B,onChange:e=>{const t=e.target.value;L(t),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{F(t),P(1)},500)},allowClear:!0,autoSize:{minRows:1,maxRows:4}})]})]})]}),o.jsx("div",{className:"flex-1 flex flex-col overflow-hidden pr-[24px] pl-[24px]",children:o.jsx(S,{rowClassName:()=>v.editableRow,data:O,columns:he,loading:K,pagination:{total:W,pageSize:U,current:q},scroll:{x:"max-content",y:"auto"},rowKey:"id",sticky:!0,onChange:e=>{P(e.current),V(e.pageSize)},bordered:!0,size:"small",rowSelection:ge,handleSave:async(t,a)=>{const r=O.find(e=>e.id===t.id);if(!r)return;const s={...r},i={};if(he.filter(e=>!0===e.meta?.editable).map(e=>e.accessorKey).filter(Boolean).forEach(e=>{t[e]!==s[e]&&(i[e]=t[e])}),0===Object.keys(i).length)return;const l=a?`${a.rowId}-${a.dataIndex}`:null;Q(l?e=>new Set(e).add(l):e=>new Set(e).add(t.id));const o=[...O],c=o.findIndex(e=>t.id===e.id);c>-1&&(o[c]={...o[c],...t},R(o));try{await n.updateHealthIndicator(t.id,i,Z);const a=E(t.full_name||t.indicator||"");j.success(`${a} ${e("update_success")}`)}catch(x){d.error("ERROR: updateHealthIndicator",x),R(e=>{const a=[...e],r=a.findIndex(e=>e.id===t.id);return r>-1&&(a[r]=s),a});const a=E(t.full_name||t.indicator||"");j.error(`${a} ${e("update_failed")}`)}finally{Q(e=>{const a=new Set(e);return l?a.delete(l):a.delete(t.id),a})}},updatingIds:J,onSortChange:(e,t)=>{ue(a=>{const r=a.findIndex(t=>t.order_key===e);if(null===t)return r>=0?a.filter((e,t)=>t!==r):a;if(r>=0){const s=[...a];return s[r]={order_key:e,order_type:t},s}return[...a,{order_key:e,order_type:t}]}),P(1)},sortState:fe})})]})]})]})})}}});
