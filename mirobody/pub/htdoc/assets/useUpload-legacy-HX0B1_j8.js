System.register(["./vendor-antd-legacy-B_nlExEM.js","./index-legacy-BCYsgP_m.js","./account-legacy-4gI0f2zM.js"],function(e,t){"use strict";var r,n,o,c,a,s,u,i,l,f;return{setters:[e=>{r=e.a,n=e.p,o=e.r},e=>{c=e.a,a=e.A,s=e.v},e=>{u=e.a,i=e.b,l=e.g,f=e.f}],execute:function(){var t,d={},p={},S={};function v(){return t||(t=1,function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.isEventSourceSupported=e.isReactNative=e.ReadyState=e.DEFAULT_HEARTBEAT=e.UNPARSABLE_JSON_OBJECT=e.DEFAULT_RECONNECT_INTERVAL_MS=e.DEFAULT_RECONNECT_LIMIT=e.SOCKET_IO_PING_CODE=e.SOCKET_IO_PATH=e.SOCKET_IO_PING_INTERVAL=e.DEFAULT_EVENT_SOURCE_OPTIONS=e.EMPTY_EVENT_HANDLERS=e.DEFAULT_OPTIONS=void 0,e.DEFAULT_OPTIONS={},e.EMPTY_EVENT_HANDLERS={},e.DEFAULT_EVENT_SOURCE_OPTIONS={withCredentials:!1,events:e.EMPTY_EVENT_HANDLERS},e.SOCKET_IO_PING_INTERVAL=25e3,e.SOCKET_IO_PATH="/socket.io/?EIO=3&transport=websocket",e.SOCKET_IO_PING_CODE="2",e.DEFAULT_RECONNECT_LIMIT=20,e.DEFAULT_RECONNECT_INTERVAL_MS=5e3,e.UNPARSABLE_JSON_OBJECT={},e.DEFAULT_HEARTBEAT={message:"ping",timeout:6e4,interval:25e3},function(e){e[e.UNINSTANTIATED=-1]="UNINSTANTIATED",e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(t||(e.ReadyState=t={})),e.isReactNative="undefined"!=typeof navigator&&"ReactNative"===navigator.product,e.isEventSourceSupported=!e.isReactNative&&function(){try{return"EventSource"in globalThis}catch(e){return!1}}()}(S)),S}var b,y={},E={};function g(){return b||(b=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetWebSockets=e.sharedWebSockets=void 0,e.sharedWebSockets={},e.resetWebSockets=function(t){if(t&&e.sharedWebSockets.hasOwnProperty(t))delete e.sharedWebSockets[t];else for(var r in e.sharedWebSockets)e.sharedWebSockets.hasOwnProperty(r)&&delete e.sharedWebSockets[r]}}(E)),E}var _,O={},h={};function m(){if(_)return h;_=1,Object.defineProperty(h,"__esModule",{value:!0}),h.setUpSocketIOPing=h.appendQueryParams=h.parseSocketIOUrl=void 0;var e=v();return h.parseSocketIOUrl=function(t){if(t){var r=/^https|wss/.test(t),n=t.replace(/^(https?|wss?)(:\/\/)?/,"").replace(/\/$/,"");return"".concat(o=r?"wss":"ws","://").concat(n).concat(e.SOCKET_IO_PATH)}if(""===t){var o=(r=/^https/.test(window.location.protocol))?"wss":"ws",c=window.location.port?":".concat(window.location.port):"";return"".concat(o,"://").concat(window.location.hostname).concat(c).concat(e.SOCKET_IO_PATH)}return t},h.appendQueryParams=function(e,t){void 0===t&&(t={});var r=/\?([\w]+=[\w]+)/.test(e),n="".concat(Object.entries(t).reduce(function(e,t){var r=t[0],n=t[1];return e+"".concat(r,"=").concat(n,"&")},"").slice(0,-1));return"".concat(e).concat(r?"&":"?").concat(n)},h.setUpSocketIOPing=function(t,r){return void 0===r&&(r=e.SOCKET_IO_PING_INTERVAL),window.setInterval(function(){return t(e.SOCKET_IO_PING_CODE)},r)},h}var T,R={};function I(){if(T)return R;T=1,Object.defineProperty(R,"__esModule",{value:!0}),R.heartbeat=function(t,r,n){var o=n||{},c=o.interval,a=void 0===c?e.DEFAULT_HEARTBEAT.interval:c,s=o.timeout,u=void 0===s?e.DEFAULT_HEARTBEAT.timeout:s,i=o.message,l=void 0===i?e.DEFAULT_HEARTBEAT.message:i,f=Math.max(100,a/10),d=Date.now(),p=setInterval(function(){var e=Date.now(),n=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e.current>t.current?e:t}).current:e.current}(r);if(n+u<=e)console.warn("Heartbeat timed out, closing connection, last message received ".concat(e-n,"ms ago, last ping sent ").concat(e-d,"ms ago")),t.close();else if(n+a<=e&&d+a<=e)try{"function"==typeof l?t.send(l()):t.send(l),d=e}catch(o){console.error("Heartbeat failed, closing connection",o instanceof Error?o.message:o),t.close()}},f);return t.addEventListener("close",function(){clearInterval(p)}),function(){}};var e=v();return R}var N,w,C,k={},A={};function P(){return N||(N=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetSubscribers=e.removeSubscriber=e.addSubscriber=e.hasSubscribers=e.getSubscribers=void 0;var t={},r=[];e.getSubscribers=function(n){return(0,e.hasSubscribers)(n)?Array.from(t[n]):r},e.hasSubscribers=function(e){var r;return(null===(r=t[e])||void 0===r?void 0:r.size)>0},e.addSubscriber=function(e,r){t[e]=t[e]||new Set,t[e].add(r)},e.removeSubscriber=function(e,r){t[e].delete(r)},e.resetSubscribers=function(e){if(e&&t.hasOwnProperty(e))delete t[e];else for(var r in t)t.hasOwnProperty(r)&&delete t[r]}}(A)),A}function L(){if(w)return k;w=1,Object.defineProperty(k,"__esModule",{value:!0}),k.assertIsWebSocket=function(e,t){if(!t&&e instanceof WebSocket==0)throw new Error("")},k.resetGlobalState=function(r){(0,t.resetSubscribers)(r),(0,e.resetWebSockets)(r)};var e=g(),t=P();return k}function M(){if(C)return O;C=1;var e=O&&O.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};Object.defineProperty(O,"__esModule",{value:!0}),O.attachListeners=void 0;var t=m(),r=I(),n=v(),o=L();return O.attachListeners=function(c,a,s,u,i,l,f){var d,p,S,v=a.setLastMessage,b=a.setReadyState;return s.current.fromSocketIO&&(d=(0,t.setUpSocketIOPing)(f)),function(e,t,r,n){e.onmessage=function(e){var o;t.current.onMessage&&t.current.onMessage(e),"number"==typeof(null==n?void 0:n.current)&&(n.current=Date.now()),"function"==typeof t.current.filter&&!0!==t.current.filter(e)||t.current.heartbeat&&"boolean"!=typeof t.current.heartbeat&&(null===(o=t.current.heartbeat)||void 0===o?void 0:o.returnMessage)===e.data||r(e)}}(c,s,v,l),function(e,t,o,c,a){e.onopen=function(s){if(t.current.onOpen&&t.current.onOpen(s),c.current=0,o(n.ReadyState.OPEN),t.current.heartbeat&&e instanceof WebSocket){var u="boolean"==typeof t.current.heartbeat?void 0:t.current.heartbeat;a.current=Date.now(),(0,r.heartbeat)(e,a,u)}}}(c,s,b,i,l),p=function(e,t,r,c,a){return n.isEventSourceSupported&&e instanceof EventSource?function(){}:((0,o.assertIsWebSocket)(e,t.current.skipAssert),e.onclose=function(e){var o;if(t.current.onClose&&t.current.onClose(e),r(n.ReadyState.CLOSED),t.current.shouldReconnect&&t.current.shouldReconnect(e)){var u=null!==(o=t.current.reconnectAttempts)&&void 0!==o?o:n.DEFAULT_RECONNECT_LIMIT;if(a.current<u){var i="function"==typeof t.current.reconnectInterval?t.current.reconnectInterval(a.current):t.current.reconnectInterval;s=window.setTimeout(function(){a.current++,c()},null!=i?i:n.DEFAULT_RECONNECT_INTERVAL_MS)}else t.current.onReconnectStop&&t.current.onReconnectStop(u),console.warn("Max reconnect attempts of ".concat(u," exceeded"))}},function(){return s&&window.clearTimeout(s)});var s}(c,s,b,u,i),S=function(t,r,o,c,a){var s;return t.onerror=function(u){var i;if(r.current.onError&&r.current.onError(u),n.isEventSourceSupported&&t instanceof EventSource&&(r.current.onClose&&r.current.onClose(e(e({},u),{code:1006,reason:"An error occurred with the EventSource: ".concat(u),wasClean:!1})),o(n.ReadyState.CLOSED),t.close()),r.current.retryOnError)if(a.current<(null!==(i=r.current.reconnectAttempts)&&void 0!==i?i:n.DEFAULT_RECONNECT_LIMIT)){var l="function"==typeof r.current.reconnectInterval?r.current.reconnectInterval(a.current):r.current.reconnectInterval;s=window.setTimeout(function(){a.current++,c()},null!=l?l:n.DEFAULT_RECONNECT_INTERVAL_MS)}else r.current.onReconnectStop&&r.current.onReconnectStop(r.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(r.current.reconnectAttempts," exceeded"))},function(){return s&&window.clearTimeout(s)}}(c,s,b,u,i),function(){b(n.ReadyState.CLOSING),p(),S(),c.close(),d&&clearInterval(d)}},O}var U,D,W={};function j(){if(U)return W;U=1;var e=W&&W.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};Object.defineProperty(W,"__esModule",{value:!0}),W.attachSharedListeners=void 0;var t=g(),r=v(),n=P(),o=m(),c=I();return W.attachSharedListeners=function(a,s,u,i){var l;return u.current.fromSocketIO&&(l=(0,o.setUpSocketIOPing)(i)),function(e,t,r){e.onmessage=function(e){(0,n.getSubscribers)(t).forEach(function(t){var n;t.optionsRef.current.onMessage&&t.optionsRef.current.onMessage(e),"number"==typeof(null===(n=null==t?void 0:t.lastMessageTime)||void 0===n?void 0:n.current)&&(t.lastMessageTime.current=Date.now()),"function"==typeof t.optionsRef.current.filter&&!0!==t.optionsRef.current.filter(e)||r&&"boolean"!=typeof r&&(null==r?void 0:r.returnMessage)===e.data||t.setLastMessage(e)})}}(a,s,u.current.heartbeat),function(e,o){e instanceof WebSocket&&(e.onclose=function(e){(0,n.getSubscribers)(o).forEach(function(t){t.optionsRef.current.onClose&&t.optionsRef.current.onClose(e),t.setReadyState(r.ReadyState.CLOSED)}),delete t.sharedWebSockets[o],(0,n.getSubscribers)(o).forEach(function(t){var n;if(t.optionsRef.current.shouldReconnect&&t.optionsRef.current.shouldReconnect(e)){var o=null!==(n=t.optionsRef.current.reconnectAttempts)&&void 0!==n?n:r.DEFAULT_RECONNECT_LIMIT;if(t.reconnectCount.current<o){var c="function"==typeof t.optionsRef.current.reconnectInterval?t.optionsRef.current.reconnectInterval(t.reconnectCount.current):t.optionsRef.current.reconnectInterval;setTimeout(function(){t.reconnectCount.current++,t.reconnect.current()},null!=c?c:r.DEFAULT_RECONNECT_INTERVAL_MS)}else t.optionsRef.current.onReconnectStop&&t.optionsRef.current.onReconnectStop(t.optionsRef.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(o," exceeded"))}})})}(a,s),function(e,t,o){e.onopen=function(a){var s=(0,n.getSubscribers)(t);s.forEach(function(t){t.reconnectCount.current=0,t.optionsRef.current.onOpen&&t.optionsRef.current.onOpen(a),t.setReadyState(r.ReadyState.OPEN),o&&e instanceof WebSocket&&(t.lastMessageTime.current=Date.now())}),o&&e instanceof WebSocket&&(0,c.heartbeat)(e,s.map(function(e){return e.lastMessageTime}),"boolean"==typeof o?void 0:o)}}(a,s,u.current.heartbeat),function(t,o){t.onerror=function(c){(0,n.getSubscribers)(o).forEach(function(n){n.optionsRef.current.onError&&n.optionsRef.current.onError(c),r.isEventSourceSupported&&t instanceof EventSource&&(n.optionsRef.current.onClose&&n.optionsRef.current.onClose(e(e({},c),{code:1006,reason:"An error occurred with the EventSource: ".concat(c),wasClean:!1})),n.setReadyState(r.ReadyState.CLOSED))}),r.isEventSourceSupported&&t instanceof EventSource&&t.close()}}(a,s),function(){l&&clearInterval(l)}},W}function F(){if(D)return y;D=1,Object.defineProperty(y,"__esModule",{value:!0}),y.createOrJoinSocket=void 0;var e=g(),t=v(),r=M(),n=j(),o=P();return y.createOrJoinSocket=function(c,a,s,u,i,l,f,d,p){if(!t.isEventSourceSupported&&u.current.eventSourceOptions)throw t.isReactNative?new Error("EventSource is not supported in ReactNative"):new Error("EventSource is not supported");if(u.current.share){var S=null;void 0===e.sharedWebSockets[a]?(e.sharedWebSockets[a]=u.current.eventSourceOptions?new EventSource(a,u.current.eventSourceOptions):new WebSocket(a,u.current.protocols),c.current=e.sharedWebSockets[a],s(t.ReadyState.CONNECTING),S=(0,n.attachSharedListeners)(e.sharedWebSockets[a],a,u,p)):(c.current=e.sharedWebSockets[a],s(e.sharedWebSockets[a].readyState));var v={setLastMessage:i,setReadyState:s,optionsRef:u,reconnectCount:f,lastMessageTime:d,reconnect:l};return(0,o.addSubscriber)(a,v),function(r,n,c,a,s){return function(){if((0,o.removeSubscriber)(r,n),!(0,o.hasSubscribers)(r)){try{var u=e.sharedWebSockets[r];u instanceof WebSocket&&(u.onclose=function(e){c.current.onClose&&c.current.onClose(e),a(t.ReadyState.CLOSED)}),u.close()}catch(i){}s&&s(),delete e.sharedWebSockets[r]}}}(a,v,u,s,S)}if(c.current=u.current.eventSourceOptions?new EventSource(a,u.current.eventSourceOptions):new WebSocket(a,u.current.protocols),s(t.ReadyState.CONNECTING),!c.current)throw new Error("WebSocket failed to be created");return(0,r.attachListeners)(c.current,{setLastMessage:i,setReadyState:s},u,l.current,f,d,p)},y}var J,x={};function G(){return J||(J=1,function(e){var t=x&&x.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,c){function a(e){try{u(n.next(e))}catch(t){c(t)}}function s(e){try{u(n.throw(e))}catch(t){c(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((n=n.apply(e,t||[])).next())})},r=x&&x.__generator||function(e,t){var r,n,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(c=0)),c;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,n=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){c.label=s[1];break}if(6===s[0]&&c.label<o[1]){c.label=o[1],o=s;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(s);break}o[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(u){s=[6,u],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},n=x&&x.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,c=t.length;o<c;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(e,"__esModule",{value:!0}),e.getUrl=void 0;var o=m(),c=v();e.getUrl=function(a,s){for(var u=[],i=2;i<arguments.length;i++)u[i-2]=arguments[i];return t(void 0,n([a,s],u,!0),void 0,function(t,n,a){var s,u,i,l,f,d,p;return void 0===a&&(a=0),r(this,function(r){switch(r.label){case 0:if("function"!=typeof t)return[3,10];r.label=1;case 1:return r.trys.push([1,3,,9]),[4,t()];case 2:return s=r.sent(),[3,9];case 3:return r.sent(),n.current.retryOnError?(u=null!==(f=n.current.reconnectAttempts)&&void 0!==f?f:c.DEFAULT_RECONNECT_LIMIT,a<u?(i="function"==typeof n.current.reconnectInterval?n.current.reconnectInterval(a):n.current.reconnectInterval,[4,(S=null!=i?i:c.DEFAULT_RECONNECT_INTERVAL_MS,new Promise(function(e){return window.setTimeout(e,S)}))]):[3,5]):[3,7];case 4:return r.sent(),[2,(0,e.getUrl)(t,n,a+1)];case 5:return null===(p=(d=n.current).onReconnectStop)||void 0===p||p.call(d,a),[2,null];case 6:return[3,8];case 7:return[2,null];case 8:return[3,9];case 9:return[3,11];case 10:s=t,r.label=11;case 11:return l=n.current.fromSocketIO?(0,o.parseSocketIOUrl)(s):s,[2,n.current.queryParams?(0,o.appendQueryParams)(l,n.current.queryParams):l]}var S})})}}(x)),x}var z,V,H={};function B(){if(V)return p;V=1;var e=p&&p.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)},t=p&&p.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,c){function a(e){try{u(n.next(e))}catch(t){c(t)}}function s(e){try{u(n.throw(e))}catch(t){c(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=p&&p.__generator||function(e,t){var r,n,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(c=0)),c;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,n=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){c.label=s[1];break}if(6===s[0]&&c.label<o[1]){c.label=o[1],o=s;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(s);break}o[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(u){s=[6,u],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},c=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0}),p.useWebSocket=void 0;var a=r(),s=n(),u=v(),i=F(),l=G(),f=c((z||(z=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.websocketWrapper=void 0,e.websocketWrapper=function(e,t){return new Proxy(e,{get:function(e,r){var n=e[r];return"reconnect"===r?t:"function"==typeof n?(console.error("Calling methods directly on the websocket is not supported at this moment. You must use the methods returned by useWebSocket."),function(){}):n},set:function(e,t,r){return/^on/.test(t)?(console.warn("The websocket's event handlers should be defined through the options object passed into useWebSocket."),!1):(e[t]=r,!0)}})},e.default=e.websocketWrapper}(H)),H)),d=L();return p.useWebSocket=function(r,n,c){void 0===n&&(n=u.DEFAULT_OPTIONS),void 0===c&&(c=!0);var p=(0,a.useState)(null),S=p[0],v=p[1],b=(0,a.useState)({}),y=b[0],E=b[1],g=(0,a.useMemo)(function(){if(!n.disableJson&&S)try{return JSON.parse(S.data)}catch(e){return u.UNPARSABLE_JSON_OBJECT}return null},[S,n.disableJson]),_=(0,a.useRef)(null),O=(0,a.useRef)(null),h=(0,a.useRef)(function(){}),m=(0,a.useRef)(0),T=(0,a.useRef)(Date.now()),R=(0,a.useRef)([]),I=(0,a.useRef)(null),N=(0,a.useRef)(n);N.current=n;var w=_.current&&void 0!==y[_.current]?y[_.current]:null!==r&&!0===c?u.ReadyState.CONNECTING:u.ReadyState.UNINSTANTIATED,C=n.queryParams?JSON.stringify(n.queryParams):null,k=(0,a.useCallback)(function(e,t){var r;void 0===t&&(t=!0),u.isEventSourceSupported&&O.current instanceof EventSource?console.warn("Unable to send a message from an eventSource"):(null===(r=O.current)||void 0===r?void 0:r.readyState)===u.ReadyState.OPEN?((0,d.assertIsWebSocket)(O.current,N.current.skipAssert),O.current.send(e)):t&&R.current.push(e)},[]),A=(0,a.useCallback)(function(e,t){void 0===t&&(t=!0),k(JSON.stringify(e),t)},[k]),P=(0,a.useCallback)(function(){return!0!==N.current.share||u.isEventSourceSupported&&O.current instanceof EventSource?O.current:(null===I.current&&O.current&&((0,d.assertIsWebSocket)(O.current,N.current.skipAssert),I.current=(0,f.default)(O.current,h)),I.current)},[]);return(0,a.useEffect)(function(){if(null!==r&&!0===c){var n,a=!1,f=!0,d=function(){return t(void 0,void 0,void 0,function(){var t,c,d;return o(this,function(o){switch(o.label){case 0:return t=_,[4,(0,l.getUrl)(r,N)];case 1:return t.current=o.sent(),null===_.current?(console.error("Failed to get a valid URL. WebSocket connection aborted."),_.current="ABORTED",(0,s.flushSync)(function(){return E(function(t){return e(e({},t),{ABORTED:u.ReadyState.CLOSED})})}),[2]):(c=function(e){a||(0,s.flushSync)(function(){return v(e)})},d=function(t){a||(0,s.flushSync)(function(){return E(function(r){var n;return e(e({},r),_.current&&((n={})[_.current]=t,n))})})},f&&(n=(0,i.createOrJoinSocket)(O,_.current,d,N,c,h,m,T,k)),[2])}})})};return h.current=function(){a||(I.current&&(I.current=null),null==n||n(),d())},d(),function(){a=!0,f=!1,I.current&&(I.current=null),null==n||n(),v(null)}}null!==r&&!1!==c||(m.current=0,E(function(t){var r;return e(e({},t),_.current&&((r={})[_.current]=u.ReadyState.CLOSED,r))}))},[r,c,C,k]),(0,a.useEffect)(function(){w===u.ReadyState.OPEN&&R.current.splice(0).forEach(function(e){k(e)})},[w]),{sendMessage:k,sendJsonMessage:A,lastMessage:S,lastJsonMessage:g,readyState:w,getWebSocket:P}},p}var K,q={};function Y(){if(K)return q;K=1;var e=q&&q.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};Object.defineProperty(q,"__esModule",{value:!0}),q.useSocketIO=void 0;var t=r(),n=B(),o=v(),c={type:"empty",payload:null};return q.useSocketIO=function(r,a,s){void 0===a&&(a=o.DEFAULT_OPTIONS),void 0===s&&(s=!0);var u=(0,t.useMemo)(function(){return e(e({},a),{fromSocketIO:!0})},[]),i=(0,n.useWebSocket)(r,u,s),l=i.sendMessage,f=i.sendJsonMessage,d=i.lastMessage,p=i.readyState,S=i.getWebSocket,v=(0,t.useMemo)(function(){return function(e){if(!e||!e.data)return c;var t=e.data.match(/\[.*]/);if(!t)return c;var r=JSON.parse(t);return Array.isArray(r)&&r[1]?{type:r[0],payload:r[1]}:c}(d)},[d]);return{sendMessage:l,sendJsonMessage:f,lastMessage:v,lastJsonMessage:v,readyState:p,getWebSocket:S}},q}var Q,$,X={},Z=($||($=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetGlobalState=e.useEventSource=e.ReadyState=e.useSocketIO=e.default=void 0;var t=B();Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.useWebSocket}});var n=Y();Object.defineProperty(e,"useSocketIO",{enumerable:!0,get:function(){return n.useSocketIO}});var o=v();Object.defineProperty(e,"ReadyState",{enumerable:!0,get:function(){return o.ReadyState}});var c=function(){if(Q)return X;Q=1;var e=X&&X.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)},t=X&&X.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};Object.defineProperty(X,"__esModule",{value:!0}),X.useEventSource=void 0;var n=r(),o=B(),c=v();return X.useEventSource=function(r,a,s){void 0===a&&(a=c.DEFAULT_EVENT_SOURCE_OPTIONS);var u=a.withCredentials,i=a.events,l=t(a,["withCredentials","events"]);void 0===s&&(s=!0);var f=e(e({},l),{eventSourceOptions:{withCredentials:u}}),d=(0,n.useRef)(c.EMPTY_EVENT_HANDLERS);i&&(d.current=i);var p=(0,o.useWebSocket)(r,f,s),S=p.lastMessage,v=p.readyState,b=p.getWebSocket;return(0,n.useEffect)(function(){(null==S?void 0:S.type)&&Object.entries(d.current).forEach(function(e){var t=e[0],r=e[1];t===S.type&&r(S)})},[S]),{lastEvent:S,readyState:v,getEventSource:b}},X}();Object.defineProperty(e,"useEventSource",{enumerable:!0,get:function(){return c.useEventSource}});var a=L();Object.defineProperty(e,"resetGlobalState",{enumerable:!0,get:function(){return a.resetGlobalState}})}(d)),d);const ee=()=>u.getState().current_drive_user_id||"",te=(e,{addUploadingFile:t})=>{const{messageId:r}=e;if(!r)return;const n=ee();if(((e,t)=>(i.getState().uploading_files.get(t)||new Map).has(e))(r,n))return;const o=(e=>{if(e.files&&e.files.length>0){const t=e.files[0];return{file_name:t.filename,file_size:t.size,file_type:t.contentType}}return e.filename?{file_name:e.filename,file_size:e.size||0,file_type:e.contentType||""}:null})(e);o&&t(r,o,n)},re=(e,{updateUploadingProgress:t})=>{const{messageId:r,progress:n,status:o,message:c}=e;if(!r)return;const a=ee(),s=(({status:e,progress:t,message:r})=>"completed"===e?{progress:100,status:"complete",message:r||"Upload completed"}:"failed"===e?{progress:t||0,status:"failed",message:r||"Upload failed"}:{progress:t||0,status:e||"uploading",message:r||""})({status:o,progress:n,message:c});t(r,s.progress,s.status,s.message,a)},ne=e=>{c.error("useUpload:: WebSocket error message",e)},oe=()=>{},ce=e=>({connection_established:oe,pong:oe,upload_start:t=>te(t,e),upload_start_confirmed:t=>te(t,e),upload_end_response:oe,upload_progress:t=>re(t,e),file_progress:t=>re(t,e),file_received:t=>((e,{updateUploadingProgress:t})=>{const{messageId:r,progress:n,status:o,message:c}=e;r&&t(r,n||100,o||"received",c||"",ee())})(t,e),upload_completed:t=>((e,{updateUploadingProgress:t})=>{const{messageId:r,message:n}=e;r&&t(r,100,"complete",n||"Upload completed",ee())})(t,e),upload_error:t=>((e,{updateUploadingProgress:t})=>{const{messageId:r,progress:n,message:o}=e;r&&t(r,n||0,"failed",o||"Upload failed",ee())})(t,e),error:ne}),ae=5242880;e("u",()=>{const e=i(e=>e.updateUploadingProgress),t=i(e=>e.addUploadingFile),[r,n]=o.useState(null),[d,p]=o.useState(null),S=o.useRef(null),v=o.useCallback(e=>!!e&&(!!(e.includes("401")||e.includes("Unauthorized")||e.includes("Token expired")||e.includes("Authentication failed")||e.toLowerCase().includes("token")&&e.toLowerCase().includes("invalid"))&&(localStorage.removeItem(a),window.location.href=`/login?redirect=${encodeURIComponent(window.location.pathname)}`,!0)),[]),b=o.useCallback((e,t,r)=>{const o=u.getState().current_drive_user_id||"";if(!r||r===o)if("error"===e)c.error("useUpload:: handleWebSocketEvent:: error",t);else if("message"===e&&t){const e={data:JSON.stringify(t)};n(e),p(t)}},[]),y=o.useCallback(()=>(S.current||(S.current=l()),S.current),[]);o.useEffect(()=>{const e=y();return e.addListener(b),()=>{e&&e.removeListener(b)}},[b,y]);const E=o.useCallback(e=>y().sendMessage(e),[y]),g=o.useMemo(()=>ce({addUploadingFile:t,updateUploadingProgress:e}),[t,e]);o.useEffect(()=>{if(r&&d)try{if(v(d.message))return;((e,t)=>{const{type:r}=e,n=t[r];n?n(e):r&&c.debug("useUpload:: Unhandled message type:",r)})(d,g)}catch(e){c.error("useUpload::WebSocket message processing error",e)}},[r,d,v,g]);const _=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result.split(",")[1]),n.onerror=r,n.readAsDataURL(e)}),O=(e,t,r)=>new Promise((n,o)=>{const c=e.slice(t,r),a=new FileReader;a.onload=()=>n(a.result.split(",")[1]),a.onerror=o,a.readAsDataURL(c)}),h=o.useCallback(async(e,r={})=>{const n=y();S.current||(S.current=n,n.addListener(b));try{await n.ensureConnected()}catch(l){return c.error("useUpload:: startUpload:: Failed to ensure connection:",l),{error:"网络连接失败，请刷新页面重试"}}const o=r.sessionId||s(),a=[],i=u.getState().current_drive_user_id||"";i||c.error("useUpload::startUpload - No current_drive_user_id, cannot add files to uploading_files");for(const u of e)try{const e=r.messageId||s();a.push(e),i&&t(e,{file_name:u.name,file_size:u.size,file_type:u.type},i);const n={type:"upload_start",messageId:e,sessionId:o,query:r.query||"",isFirstMessage:r.isFirstMessage||!1,files:[{filename:u.name,contentType:u.type,size:u.size}],query_user_id:r.query_user_id||"",...r.metadata&&{metadata:r.metadata}};E(JSON.stringify(n));const c=Math.ceil(u.size/ae);if(u.size<=ae){const t=await _(u);E(JSON.stringify({type:"upload_chunk",messageId:e,filename:u.name,contentType:u.type,chunk:t,chunkIndex:0,totalChunks:1,fileSize:u.size}))}else for(let t=0;t<c;t++){const r=t*ae,n=Math.min(r+ae,u.size),o=await O(u,r,n);E(JSON.stringify({type:"upload_chunk",messageId:e,filename:u.name,contentType:u.type,chunk:o,chunkIndex:t,totalChunks:c,fileSize:u.size}))}E(JSON.stringify({type:"upload_end",messageId:e,sessionId:o}))}catch(f){return c.error("ERROR: startUpload",f),null}return a},[E,y,b,t]),m=o.useCallback(async(e,r={})=>{try{const n=e.map(e=>e.file),o=await h(n,r);return o&&o.length===e.length&&e.forEach((e,r)=>{t(o[r],{...e,show_file_size:f(e.file_size)})}),o}catch(n){return c.error("ERROR:: uploadFiles::",n),null}},[h,t]),T=o.useCallback(e=>{E(JSON.stringify({type:"get_status",messageId:e}))},[E]);return{sendMessage:E,lastMessage:r,readyState:(()=>{if(!S.current)return Z.ReadyState.CLOSED;const e=S.current.getReadyState();return e===WebSocket.CONNECTING?Z.ReadyState.CONNECTING:e===WebSocket.OPEN?Z.ReadyState.OPEN:e===WebSocket.CLOSING?Z.ReadyState.CLOSING:Z.ReadyState.CLOSED})(),uploadFiles:m,startUpload:h,getUploadStatus:T,isConnected:S.current?.isConnected()??!1,isConnecting:S.current?.isConnecting()??!1}})}}});
